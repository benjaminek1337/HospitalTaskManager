<div class="scheduler" *ngIf="isLoaded">
    <!-- dataCellTemplate="dataCellTemplate" -->
    <dx-scheduler 
        [views]='["Dagtid"]' 
        [dataSource]="scheduledProcedureData" 
        [showAllDayPanel]="false"
        [groups]="['staffId']" 
        currentView="timelineDay" 
        [currentDate]="mockDate"
        [showCurrentTimeIndicator]='showCurrentTimeIndicator' 
        [shadeUntilCurrentTime]='shadeUntilCurrentTime'
        [firstDayOfWeek]="1" 
        [startDayHour]="0" 
        [endDayHour]="24" 
        [cellDuration]="15" 
        appointmentTooltipTemplate="tooltipTemplate" 
        appointmentTemplate="appointmentTemplate"

        resourceCellTemplate="resourceCellTemplate"
        crossScrollingEnabled="true"
        timeCellTemplate="timeCellTemplate"
        (onAppointmentDblClick)="DisableClickEvent($event)"
        (onAppointmentFormOpening)="DisableAppointmentForm($event)"
        >
        <dxo-editing #editingOptions
        [allowAdding]="false"
        [allowDeleting]="false"
        [allowUpdating]="false"
        [allowResizing]="false"
        [allowDragging]="false"
    ></dxo-editing>
        <dxi-view
            name="Dagtid"
            type="timelineDay"
            maxAppointmentsPerCell="auto">
        </dxi-view>
        <dxi-resource 
            fieldExpr="staffId" 
            [allowMultiple]="true"
            [dataSource]="scheduledStaff" 
            label="Personal">
        </dxi-resource>
        <dxi-resource 
            [dataSource]="statusData" 
            [useColorAsDefault]="true" 
            fieldExpr="statusId" 
            label="Status">
        </dxi-resource>
    
        <div #datacells *dxTemplate="let data of 'dataCellTemplate'; let listIndex = index">
            <div  class="notWorkTime" [ngClass]="GetWorkHours(data)" style="min-width: 25px; height: 100%;">&nbsp;</div>
        </div>
        
        <!-- In me arbetstid nedan -->
        <div *dxTemplate="let employee of 'resourceCellTemplate'">
                <span *ngIf="IsWorkHour(employee.id) == 'inside'" class="dot-green"></span>
                <span *ngIf="IsWorkHour(employee.id) == 'outside'" class="dot-yellow"></span>
                <h4>{{ GetEmployee(employee.id).firstName + " " + GetEmployee(employee.id).lastName }}</h4>
                <!-- <p>Arbetstid in hit</p> -->
        </div>
    
        <div *dxTemplate="let time of 'timeCellTemplate'">
            <h4 *ngIf="time.text.includes(':00') " style="color:black;">{{time.text.substring(0,2)}}</h4>
        </div>
    
        <div class="appointmentTemplate" *dxTemplate="let model of 'appointmentTemplate'">
            <div *ngIf="model.appointmentData.statusId != null">
                <p>{{ (model.appointmentData.text) }}</p>  
                <p>{{ (model.appointmentData.startDate | date:'HH:mm') 
                    + ' - ' + 
                    (model.appointmentData.endDate | date:'HH:mm') }}</p>
            </div>
        </div>
    
        <div *dxTemplate="let model of 'tooltipTemplate'">
            <div class="appointmentTooltip" (click)="StopPropagnation($event)">
                <div class="tooltipHeader">
                    <h4>{{model.appointmentData.text}}</h4>
                    <p>Status: {{ GetProcedureStatus(model.appointmentData.statusId).text }}</p>
                    <br>
                </div>
                <div class="tooltipStaff">
                    <h4>Bemanning:</h4>
                    <ul>
                        <li *ngFor="let item of model.appointmentData.staffId; let i = index">
                            <p class="tooltipTextDeviation" *ngIf="GetStaffPresenceStatus(item).onSite == false
                            && model.appointmentData.statusId !=1" >
                                {{GetEmployee(item).firstName + " " + GetEmployee(item).lastName}} är frånvarande.
                                <br>
                                Telefonnr: {{GetEmployee(item).phoneNr}} 
                                <br>
                            </p>
                            <p *ngIf="GetStaffPresenceStatus(item).onSite == true 
                                || model.appointmentData.statusId == 1">
                                {{GetEmployee(item).firstName + " " + GetEmployee(item).lastName}}
                            </p>
                        </li>
    
                    </ul>
                    <br>
                </div>
                <div class="tooltipDeviation" *ngIf="model.appointmentData.statusId == 2 || model.appointmentData.statusId == 3 ">
                    <button mat-raised-button color="accent" (click)="MarkProcedureAsHandled(model.appointmentData.procedureId)">Markera som hanterad</button>
                    <br>
                </div>
                <div class="tooltipDeviation" *ngIf="model.appointmentData.isHandled == true">
                    <button mat-raised-button color="accent" (click)="MarkProcedureAsUnhandled(model.appointmentData.procedureId)">Markera som avvikande</button>
                    <br>
                </div>
            </div>
        </div>
    </dx-scheduler>
</div>

<div class="wrapper" *ngIf="isLoaded">
    <div class="table">
        <div class="row">
            <div class="statusbox" aria-colspan="3">
                <app-statuscenter 
                [scheduledProcedureData]="scheduledProcedureData" 
                [scheduleData]="scheduleData"
                [staffData]="staffData" >
                </app-statuscenter>
            </div>
        </div>
        <div class="row">
            <div class="availableStaffListBox">
                <app-available-staff-list
                [_scheduledProcedureData]="scheduledProcedureData" 
                [_scheduleData]="scheduleData"
                [_staffData]="staffData">
                </app-available-staff-list>
            </div>
        </div>
    </div>
</div>